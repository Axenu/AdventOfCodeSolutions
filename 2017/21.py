input_data = '''../.. => #.#/###/#.#
#./.. => ..#/.../###
##/.. => .../.##/###
.#/#. => #.#/##./.#.
##/#. => #../#.#/..#
##/## => #.#/#../###
.../.../... => .###/..##/.#../###.
#../.../... => ##.#/.###/#.../##.#
.#./.../... => ..../#.##/..../.#.#
##./.../... => ..#./#.../#.../.###
#.#/.../... => ..##/####/#.#./..##
###/.../... => .##./#.#./###./.#..
.#./#../... => #..#/..#./...#/#.#.
##./#../... => ##../.##./##.#/#..#
..#/#../... => #.##/.##./##.#/.###
#.#/#../... => ...#/#.##/..#./##..
.##/#../... => #.#./..#./##.#/.#.#
###/#../... => #..#/...#/..#./##.#
.../.#./... => .#.#/#.../.##./.#.#
#../.#./... => #.#./.##./..../.#.#
.#./.#./... => .#../#.##/..##/..##
##./.#./... => ..##/##.#/...#/..#.
#.#/.#./... => ...#/.##./####/.#..
###/.#./... => ###./####/...#/####
.#./##./... => ...#/.#.#/#.#./#.#.
##./##./... => ..../...#/#.#./...#
..#/##./... => .##./#.../##.#/.#..
#.#/##./... => .#../.#../...#/....
.##/##./... => ..#./.##./####/.#..
###/##./... => ##../.#.#/##../.#..
.../#.#/... => ..#./.#../.#../.###
#../#.#/... => ####/..../#..#/#...
.#./#.#/... => #.##/##../##.#/##.#
##./#.#/... => ###./..../#.##/###.
#.#/#.#/... => ###./.#../#.#./#.#.
###/#.#/... => ...#/#..#/#.#./..##
.../###/... => .#../...#/...#/....
#../###/... => ####/#.../##../.#.#
.#./###/... => ...#/####/.##./#..#
##./###/... => .###/##.#/..#./.#..
#.#/###/... => ####/###./.###/.###
###/###/... => .#.#/..##/..#./##..
..#/.../#.. => #.../.###/###./...#
#.#/.../#.. => ..../#.../##../..#.
.##/.../#.. => ####/####/...#/####
###/.../#.. => #.../.#../#.#./#.#.
.##/#../#.. => ##../..#./.#../##.#
###/#../#.. => ..../#..#/.###/.###
..#/.#./#.. => ...#/##../.##./##..
#.#/.#./#.. => #.##/.###/#.#./##.#
.##/.#./#.. => ..../..../.#.#/#..#
###/.#./#.. => ##../.#.#/.#.#/####
.##/##./#.. => #.##/##.#/####/....
###/##./#.. => ..../..##/#.#./.###
#../..#/#.. => #.#./...#/#.##/.###
.#./..#/#.. => ####/#.##/.#../.###
##./..#/#.. => .##./..#./.#.#/##.#
#.#/..#/#.. => .#.#/#.##/##../#...
.##/..#/#.. => ..../.###/####/.#..
###/..#/#.. => ##.#/##.#/..##/.#..
#../#.#/#.. => #.##/###./##../....
.#./#.#/#.. => ..../###./####/###.
##./#.#/#.. => ##.#/#.##/##../#.##
..#/#.#/#.. => .###/#.../.#../##..
#.#/#.#/#.. => ##../##.#/#.../.##.
.##/#.#/#.. => ...#/..#./.###/##.#
###/#.#/#.. => #.../#.##/..##/..##
#../.##/#.. => #.##/#.../.##./##..
.#./.##/#.. => #.#./#.../..##/.#..
##./.##/#.. => .###/.#.#/####/.#.#
#.#/.##/#.. => ####/.#../##.#/.###
.##/.##/#.. => .#../##.#/####/#.#.
###/.##/#.. => #.##/#.../...#/....
#../###/#.. => ###./.#.#/##../#..#
.#./###/#.. => #..#/..##/..../....
##./###/#.. => ..#./#.../...#/###.
..#/###/#.. => ##../..##/##../#.##
#.#/###/#.. => ..../..#./.###/##..
.##/###/#.. => #..#/####/.#.#/.##.
###/###/#.. => ###./#.##/##.#/.#..
.#./#.#/.#. => #.../####/#.#./.##.
##./#.#/.#. => ..##/..../.#.#/##..
#.#/#.#/.#. => ####/..##/####/#...
###/#.#/.#. => ##.#/#.#./.##./####
.#./###/.#. => .#.#/.#.#/##.#/###.
##./###/.#. => .#../###./#.##/#...
#.#/###/.#. => #.../.###/.#../.#..
###/###/.#. => #.#./.##./.###/####
#.#/..#/##. => .#../#..#/###./#.##
###/..#/##. => #.#./####/###./###.
.##/#.#/##. => .#.#/...#/..../#.##
###/#.#/##. => ...#/..../#.##/####
#.#/.##/##. => ##../.#../.#.#/##..
###/.##/##. => #.../#.#./#.#./#.#.
.##/###/##. => ..../#.##/#.##/..##
###/###/##. => ####/##.#/#..#/.##.
#.#/.../#.# => ##.#/.#.#/####/.##.
###/.../#.# => #..#/.#.#/#.../#..#
###/#../#.# => ..##/###./.###/..##
#.#/.#./#.# => #.##/#.#./##../...#
###/.#./#.# => ..#./.###/..##/#...
###/##./#.# => #.../...#/..##/.###
#.#/#.#/#.# => #..#/.#../...#/#..#
###/#.#/#.# => ###./#.../##../.##.
#.#/###/#.# => ...#/..#./...#/#..#
###/###/#.# => ###./####/.###/###.
###/#.#/### => .###/.#../..../##.#
###/###/### => #..#/.###/##../.##.'''

# input_data = '''../.# => ##./#../...
# .#./..#/### => #..#/..../..../#..#'''

start = [['.', '#', '.'],['.', '.', '#'], ['#', '#', '#']]

small_rules = []
small_passed = {}
large_rules = []
large_passed = {}

for row in input_data.split('\n'):
    if row[2] == '/':
        vals = row.split(' => ')
        small_rules.append(vals)
    else:
        vals = row.split(' => ')
        large_rules.append(vals)

def rotate2(shape='#./.#'):
    # print shape
    res = list(shape)
    res[0] = shape[3]
    res[1] = shape[0]
    res[3] = shape[4]
    res[4] = shape[1]
    return ''.join(res)

def rotate3(shape='.#./..#/###'):
    res = list(shape)

    res[0] = shape[4]
    res[1] = shape[0]
    res[2] = shape[1]
    res[4] = shape[8]
    res[6] = shape[2]
    res[8] = shape[9]
    res[9] = shape[10]
    res[10] = shape[6]

    return ''.join(res)

def flip3(shape='.#./..#/###'):
    res = list(shape)

    res[0] = shape[8]
    res[1] = shape[9]
    res[2] = shape[10]
    res[8] = shape[0]
    res[9] = shape[1]
    res[10] = shape[2]

    return ''.join(res)

def test2(shape):
    # for rule in small_passed:
        # if rule[0] == shape:
            # return rule[1]
    if shape in small_passed:
        return small_passed[shape]
    for rule in small_rules:
        if rule[0] == shape:
            small_passed[shape] = rule[1]
            return rule[1]
        r = rotate2(shape)
        if rule[0] == r:
            small_passed[r] = rule[1]
            return rule[1]
        r = rotate2(r)
        if rule[0] == r:
            small_passed[r] = rule[1]
            return rule[1]
        r = rotate2(r)
        if rule[0] == r:
            small_passed[r] = rule[1]
            return rule[1]


def test3(shape):
    if shape in large_passed:
        return large_passed[shape]
    for rule in large_rules:
        if rule[0] == shape:
            large_passed[shape] = rule[1]
            return rule[1]
        r = shape
        for x in xrange(0, 4):
            r = rotate3(r)
            r = rotate3(r)
            if rule[0] == r:
                large_passed[r] = rule[1]
                return rule[1]
        r = flip3(r)
        for x in xrange(0, 4):
            r = rotate3(r)
            r = rotate3(r)
            if rule[0] == r:
                large_passed[r] = rule[1]
                return rule[1]

size = 3
shape = '.#./..#/###'
shape = shape.split('/')
print shape
new = ''
for i in xrange(0, 18):
    new = ''
    n = []
    step = 3
    if size % 2 == 0:
        step = 2
    for x in xrange(0, size, step):
        for y in xrange(0, size, step):
            s = y*(size+1) + x
            # ss = shape.split('/')
            part = ''
            part += shape[y][x:x+step] + '/'
            part += shape[y+1][x:x+step]
            if step == 3:
                part += '/' + shape[y+2][x:x+step]
                res = test3(part)
                # print res
                if y == 0 and x == 0:
                    # new = res
                    n = res.split('/')
                elif x == 0:
                    # new += '/' + res
                    n += res.split('/')
                else:
                    # n = new.split('/')
                    st = x + x/3
                    yy = y + y/3
                    n[yy] = n[yy][:st] + res[0:4] + n[yy][st:]
                    n[yy+1] = n[yy+1][:st] + res[5:9] + n[yy+1][st:]
                    n[yy+2] = n[yy+2][:st] + res[10:14] + n[yy+2][st:]
                    n[yy+3] = n[yy+3][:st] + res[15:19] + n[yy+3][st:]
                    # new = new[:st] + res[0:3] + new[st:]
                    # new = '/'.join(n)
            else:
                res = test2(part)
                if y == 0 and x == 0:
                    # new = res
                    n = res.split('/')
                elif x == 0:
                    # new += '/' + res
                    n += res.split('/')
                else:
                    # n = new.split('/')
                    st = x + x/2
                    yy = y + y/2
                    n[yy] = n[yy][:st] + res[0:3] + n[yy][st:]
                    n[yy+1] = n[yy+1][:st] + res[4:7] + n[yy+1][st:]
                    n[yy+2] = n[yy+2][:st] + res[8:11] + n[yy+2][st:]
                    # new = '/'.join(n)
    # shape = new
    shape = n
    print i
    # print shape
    size += size/step

print shape

count = 0
for s in shape:
    for x in s:
        if x == '#':
            count += 1

print count

#169
#353
#190 -- right






    # if size % 2 == 0:
    #     res = test2(shape)
    #     print res
    # else:
    #     res = test3(shape)
    #     print res

# print test3('..#/#../###')

# print rotate2()
# print rotate3()
# print flip3()


# print test2('.#/..')

#
# def testShape(shape, small=True):
#     print shape
#     l = large_rules
#     if small:
#         l = small_rules
#
#
#     for rule in l:
#         if start == rule[0]:
#             return rule[1]
#         #rotate:
#
#
#     print 'not found'
#     return []
#
#
# for row in input_data.split('\n'):
#     if row[2] == '/':
#         vals = row.split(' => ')
#         small_rules.append((map(list, vals[0].split('/')), map(list, vals[1].split('/'))))
#     else:
#         vals = row.split(' => ')
#         large_rules.append((map(list, vals[0].split('/')), map(list, vals[1].split('/'))))

#
# for i in xrange(0, 2):
#     if len(start) % 3 == 0:
#         new = []
#         for j in xrange(0, (len(start) + len(start)/3)):
#             new.append(['.'] * (len(start) + len(start)/3))
#         for x in xrange(0, len(start), 3):
#             for y in xrange(0, len(start), 3):
#                 res = testShape(start[x:x+3][y:y+3], False)
#                 # new[x:x+4][y:y+4] = res
#                 for xx in xrange(0, 4):
#                     for yy in xrange(0, 4):
#                         new[xx + x][yy + y] = res[xx][yy]
#                 print new
#         start = new
#     elif len(start) % 2 == 0:
#         new = []
#         for j in xrange(0, (len(start) + len(start)/2)):
#             new.append(['.'] * (len(start) + len(start)/2))
#         for x in xrange(0, len(start), 2):
#             for y in xrange(0, len(start), 2):
#                 shape = []
#                 for xx in xrange(0, 2):
#                     s = []
#                     for yy in xrange(0, 2):
#                         s.append(start[xx+x][yy+y])
#                     shape.append(s)
#                 res = testShape(shape, True)
#                 # new[x:x+4][y:y+4] = res
#                 for xx in xrange(0, 2):
#                     for yy in xrange(0, 2):
#                         new[xx + x][yy + y] = res[xx][yy]
#                 print new
#         start = new
#         print new

#3->4->6->8->12->16










#
